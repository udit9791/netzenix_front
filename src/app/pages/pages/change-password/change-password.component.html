<vex-secondary-toolbar current="Change Password">
  <vex-breadcrumbs [crumbs]="['Profile', 'Change Password']" class="flex-auto"></vex-breadcrumbs>
</vex-secondary-toolbar>

<div class="p-6 container">
  <div class="card flex-auto">
    <div class="px-6 py-4 border-b flex items-center">
      <h2 class="title m-0">Change Password</h2>
    </div>

    <form
      class="px-6 py-4 flex flex-col gap-4"
      [formGroup]="changePasswordForm"
      (ngSubmit)="onSubmit()"
    >
      <!-- Current Password -->
      <mat-form-field>
        <mat-label>Current Password</mat-label>
        <input
          matInput
          [type]="hideCurrent ? 'password' : 'text'"
          formControlName="current_password"
          required
        />
        <button mat-icon-button matSuffix type="button" (click)="hideCurrent = !hideCurrent">
          <mat-icon>{{ hideCurrent ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('current_password')?.hasError('required')">
          Current password is required
        </mat-error>
      </mat-form-field>

      <!-- New Password -->
      <mat-form-field>
        <mat-label>New Password</mat-label>
        <input
          matInput
          [type]="hideNew ? 'password' : 'text'"
          formControlName="new_password"
          required
        />
        <button mat-icon-button matSuffix type="button" (click)="hideNew = !hideNew">
          <mat-icon>{{ hideNew ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('new_password')?.hasError('required')">
          New password is required
        </mat-error>
        <mat-error *ngIf="changePasswordForm.get('new_password')?.hasError('minlength')">
          Password must be at least 6 characters long
        </mat-error>
      </mat-form-field>

      <!-- Confirm Password -->
      <mat-form-field>
        <mat-label>Confirm Password</mat-label>
        <input
          matInput
          [type]="hideConfirm ? 'password' : 'text'"
          formControlName="confirm_password"
          required
        />
        <button mat-icon-button matSuffix type="button" (click)="hideConfirm = !hideConfirm">
          <mat-icon>{{ hideConfirm ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
        <mat-error *ngIf="changePasswordForm.get('confirm_password')?.hasError('required')">
          Please confirm your password
        </mat-error>
        <mat-error *ngIf="changePasswordForm.hasError('mismatch')">
          Passwords do not match
        </mat-error>
      </mat-form-field>

      <!-- Actions -->
      <div class="flex items-center justify-end gap-2">
        <button mat-button type="button" (click)="resetForm()">Cancel</button>
        <button
          color="primary"
          mat-flat-button
          type="submit"
          [disabled]="changePasswordForm.invalid"
        >
          Update Password
        </button>
      </div>
    </form>
  </div>
</div>
